<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="generator" content="Some custom Common Lisp"><meta name="description" content="The site's offline mode controls, reasoning and documentation"><script defer src="/static/fixes.js"></script><link rel="alternate" href="/feed.xml" title="Fanael's random ruminations" type="application/rss+xml"><link rel="stylesheet" href="/static/theme.css"><link rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/"><title>Offline mode - Fanael's random ruminations</title></head><body><header id="top-header"><a id="skip-nav" class="at-only" href="#main">Skip to main content</a><div><span>Fanael's random ruminations</span></div></header><nav aria-label="Primary"><ul id="top-nav"><li><a href="/">Main page</a></li><li><a href="/archives/">Archives</a></li><li><a href="https://github.com/Fanael/fanael.github.io/">GitHub</a></li><li><a rel="author" href="/pages/about.html">About</a></li></ul></nav><main id="main"><article><header><h1><a class="section-link" href="#main"><span>Offline mode</span><span aria-hidden="true"> §</span></a></h1></header><script defer src="/static/offline-control.js"></script><p><output id="status-bar" aria-live="polite">JavaScript did not load.</output></p><ul><li><button type="button" disabled id="worker-toggle">Enable offline mode</button></li><li><button type="button" disabled id="fetch-all">Update all pages</button></li><li><button type="button" disabled id="clear-cache">Clear offline mode cache</button></li></ul><nav class="toc" aria-labelledby="toc-label"><span id="toc-label">Table of contents</span><ol><li><a href="#what-is-this">What is this?</a></li><li><a href="#how-to-use">How do I use it?</a></li></ol></nav><section id="what-is-this"><h2><a class="section-link" href="#what-is-this"><span>What is this?</span><span aria-hidden="true"> §</span></a></h2><p>Since this blog is just a static website, it should be easy for it to be fully readable even with no internet connection. After all, only approximately 0% of the population of this planet have access to cheap, reliable, fast, always-active internet connection. This has always been <em>possible</em> by cloning the git repository and running an <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP</a> server locally, but that hardly qualifies as <em>easy</em>.</p><p>However, certain features of modern browsers, introduced primarily for use with <a href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps">progressive web applications</a>, make it possible with just a tiny bit of JavaScript: by registering a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API">service worker</a> it is possible for a site to manually performing any caching it desires using the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache">cache interface</a>.</p><p>If you want to be able to read this blog while offline, because, for instance, you have access to fast internet only sporadically, then this feature is something made for you.</p><div class="info"><p>Naturally, this feature requires storing the cached pages on your device. None of it ever <em>leaves</em> your device, it is only used locally by the service worker running locally in the browser, unless an undocumented "feature" of the browser causes it to be sent somewhere for some reason? For that, I can only recommend avoiding proprietary software and other forms of malware.</p><p>The <a href="/static/offline-control.js"> source code of the script controlling interaction on this page</a> and the <a href="/sw.js"> source code of the service worker itself</a> are of course available, if you want to audit them before executing either, or if you want to know how it's done. It's just a small amount of vanilla JavaScript, with no fancy frameworks; it's not even <a href="https://en.wikipedia.org/wiki/Minification_(programming)">minified</a> — they're so short that minification wouldn't save much after <a href="https://en.wikipedia.org/wiki/HTTP_compression">transfer compression</a>.</p></div></section><section id="how-to-use"><h2><a class="section-link" href="#how-to-use"><span>How do I use it?</span><span aria-hidden="true"> §</span></a></h2><p>Just enable it. After enabling, all visited pages from now on will be saved into the offline mode cache for later viewing. Requests for saved pages will be served from the cache if no network connection is present, if a server error occurs or if the network takes too long.</p><p>If connected to a slow or intermittent network, requests are still made, in hope of acquiring the up-to-date version of the page. Even if the network ends up being too slow and the cached version is served, the request continues running in the background so that the cache can be updated with the up-to-date version of the page once it finishes.</p><p>The <a href="#fetch-all">"update all pages" button</a> simply downloads the current versions of all pages on the site and stores them in the cache, which is very handy for allowing all contents of the site to be viewed offline.</p><p>The <a href="#clear-cache">"clear offline mode cache" button</a> removes all pages stored by this site in the cache storage. This is roughly equivalent to removing all stored data for this site in browser settings.</p><p>Note that all network requests performed by the offline mode service worker <em>are still subject to the browser's own cache</em>: the browser can simply return cached data for a "network" request, without ever involving the network proper, and it can ask the server if its cached version is still current, for example using the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-Modified-Since"><code>If-Modified-Since</code></a> header. The amount of data transferred should therefore be similar whether the offline mode is enabled or not.</p></section></article></main><nav aria-label="Chronological, secondary"><ul id="order-nav"><li class="top"><a href="#skip-nav"><span aria-hidden="true">↑ </span>Top<span aria-hidden="true"> ↑</span></a></li><li class="prev"></li><li><a href="/archives/">Blog archives</a></li><li class="next"></li></ul></nav><footer><ul id="footer"><li><a href="/pages/offline-mode.html">Offline mode</a></li><li>Powered by HTML &amp; CSS</li><li>Copyright © 2019-2023 Fanael Linithien</li><li>Licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a></li></ul></footer></body></html>